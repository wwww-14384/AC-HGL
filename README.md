# AC-HGL
AC-HGL:Heterogeneous Graph Representation Learning through Adaptive Correlation for Stock Movement Prediction
Here is the official code and supplementary materials for the GC-AGL model:AC-HGL is a model designed for stock price prediction. Then AC method constructs multiple correlation graphs and aggregates them to acquire the adaptive correlation representations. And HGL method aggregates different representations of heterogeneous graphs via varying feature strengths, and optimizes the dynamic weights based on the contributions of different modules.

<img width="1336" height="748" alt="image" src="https://github.com/user-attachments/assets/c5e594fd-9249-49b0-bc81-86ae15295b20" />

Our initial experiments were conducted within a complex business codebase developed based on Qlib.
The original code is comprehensive, and we will release the dataset and core code in the future.

<img width="185" height="145" alt="image" src="https://github.com/user-attachments/assets/49b3e8ed-1ee8-4b42-8ae9-ab62f4c56f2c" /> <img width="127" height="141" alt="image" src="https://github.com/user-attachments/assets/e1c45153-6089-4233-b8e7-78de0becb205" /> <img width="117" height="143" alt="image" src="https://github.com/user-attachments/assets/5a02d834-87f1-4065-9e54-fec82b421fe9" />

Box Plot and Gaussian Distribution of P-Values for Cross-Moran's I respectively compare the box plot and Gaussian distributions of Cross-Moran's I p-values across different trading days (i.e., 2008 crisis versus 2019 normal markets). The distribution predominantly clusters around p < 0.05, indicating statistically significant results. This stability persists even when including extreme trading days, demonstrating the model's robustness to market conditions. Crisis Market: The box is concentrated in the low-value range (approximately 0.0 to 0.2), with a low median. The overall value range is small and relatively low. Normal Market: The box has a large span, with a high median. The value range extends from low to 1.0, and the overall distribution is more dispersed with higher values. Because the impact of crisis events on the market is clear and strongly directional, the relationship between variables shows "strong significance" — corresponding to a low p-value in statistical tests (the lower the p-value, the stronger the significance, that is, the more sufficient the evidence that "the event impact is certain"), making it easier to reject the null hypothesis. In the normal market, multiple factors such as macroeconomics, industry cycles, individual companies, and policy expectations work together, and investors have diverse trading logics, leading to the amplification of "differences" in market volatility and a more dispersed numerical distribution.


<img width="201" height="156" alt="image" src="https://github.com/user-attachments/assets/9cb01a9f-24a7-4b56-b2e3-e8b4c22f48eb" /> <img width="195" height="159" alt="image" src="https://github.com/user-attachments/assets/66142b7e-e05c-4382-9eec-49bc1d87791d" />

Comparing Shap Value(left) and Shap Value(right), for the same feature factor, e.g., TS_F20 (the momentum divergence feature) negatively influences the model’s judgment of a “panic sell-off” in crisis markets; In normal markets, it positively influences the model's judgment of “trend continuation” indicating a reversal in the logic of its effect. In addition, TS_F22 (the medium-term mean reversion feature, Mean (close,30)/close), in crisis markets, where stock prices experience continuous and sharp declines (e.g., multiple circuit breakers in 2008), the 30-day moving average shifts downward rapidly with the price, but the current price falls even faster, which leads to a sharp increase for TS_F22; In normal markets, this (oversold) condition typically positively influences the model to predict a “rebound”. 
Overall, in crisis markets, features have a "large impact magnitude" on the model (e.g., TS_F62 (the volatility indicator) has a SHAP value exceeding 0.3); In normal markets, features have a "moderate impact magnitude" on the model (e.g., TS_F54 (the price-volume synergy) has SHAP values mostly within the ±0.2 range). These results indicate that feature strength varies significantly with the market environment. Therefore, the constructed relationship graph cannot solely rely on original features without considering feature strength. So it seems to be that our model will provide actionable insights for traders to some extent.
